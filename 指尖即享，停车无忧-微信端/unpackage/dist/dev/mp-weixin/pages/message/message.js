(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/message/message"],{100:function(e,t,n){},92:function(e,t,n){"use strict";(function(e,t){var a=n(4);n(26);a(n(25));var i=a(n(93));e.__webpack_require_UNI_MP_PLUGIN__=n,t(i.default)}).call(this,n(1)["default"],n(2)["createPage"])},93:function(e,t,n){"use strict";n.r(t);var a=n(94),i=n(96);for(var o in i)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);n(99);var r,s=n(32),c=Object(s["default"])(i["default"],a["render"],a["staticRenderFns"],!1,null,null,null,!1,a["components"],r);c.options.__file="pages/message/message.vue",t["default"]=c.exports},94:function(e,t,n){"use strict";n.r(t);var a=n(95);n.d(t,"render",(function(){return a["render"]})),n.d(t,"staticRenderFns",(function(){return a["staticRenderFns"]})),n.d(t,"recyclableRender",(function(){return a["recyclableRender"]})),n.d(t,"components",(function(){return a["components"]}))},95:function(e,t,n){"use strict";var a;n.r(t),n.d(t,"render",(function(){return i})),n.d(t,"staticRenderFns",(function(){return r})),n.d(t,"recyclableRender",(function(){return o})),n.d(t,"components",(function(){return a}));var i=function(){var e=this,t=e.$createElement,n=(e._self._c,e.__map(e.date,(function(t,n){var a=e.__get_orig(t),i=t.status?null:e.dealTimer(t);return{$orig:a,m0:i}})));e.$mp.data=Object.assign({},{$root:{l0:n}})},o=!1,r=[];i._withStripped=!0},96:function(e,t,n){"use strict";n.r(t);var a=n(97),i=n.n(a);for(var o in a)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(o);t["default"]=i.a},97:function(e,t,n){"use strict";(function(e,a){var i=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(n(87)),r=n(98),s=n(88),c={data:function(){return{title:"停车管理系统",date:[{id:0,name:"车位一",startNowTimer:"",startTimer:[0,0],endTimer:[0,0],status:!1},{id:1,name:"车位二",startNowTimer:"",startTimer:[0,0],endTimer:[0,0],status:!1},{id:2,name:"车位三",startNowTimer:"",startTimer:[0,0],endTimer:[0,0],status:!1},{id:3,name:"车位四",startNowTimer:"",startTimer:[0,0],endTimer:[0,0],status:!1}],carStatus:!0,nowTimer:"2023/1/3 18:50:00",dealTimers:[0,0],runTime:[],indicatorDots:!0,autoplay:!0,interval:2e3,duration:500,data:{client:null,reconnectCounts:0,options:{protocolVersion:4,clean:!1,reconnectPeriod:1e3,connectTimeout:3e4,resubscribe:!0,clientId:"",password:"",username:""},aliyunInfo:{productKey:"i4c2LeyEp9M",deviceName:"weichat",deviceSecret:"90d13b23ce47fd5f2dab1a5371247167",regionId:"cn-shanghai",pubTopic:"/i4c2LeyEp9M/weichat/user/update",subTopic:"/i4c2LeyEp9M/weichat/user/get"}}}},methods:{dealTimer:function(e){var t=e.startTimer,n=e.endTimer;return n[0]-t[0]>0?n[1]-t[1]:60*(n[0]-t[0]-1)+(60-t[1])+n[1]},dealTimered:function(e){var t=e.startTimer,n=this.dealTimers;return n[0]-t[0]>0?n[1]-t[1]:60*(n[0]-t[0]-1)+(60-t[1])+n[1]},cachesSetStorge:function(t){t.length;t.map((function(t,n){e.setStorage({key:n+"",data:t,success:function(e){console.log("已经储存信息")}})}))},getCachesData:function(){var t=this,n=this.date;n.map((function(a,i){e.getStorage({key:i+"",success:function(e){t.date[i]=e.data},fail:function(){e.setStorage({key:i+"",data:n[1],success:function(){console.log("初始化数据成功")}})}})}))},connectAliYun:function(){var e=this,t=this,n=this.date;this.getCachesData();setInterval((function(){var a=new Date,i=t.runTime,o=(0,r.formatTime)(a);e.nowTimer=o.timer,e.dealTimers=o.jiluTimer;n.map((function(e,n){1==e.status&&(i[n]=t.dealTimered(e))}))}),1e3);var i=s.getAliyunIotMqttClient({productKey:t.data.aliyunInfo.productKey,deviceName:t.data.aliyunInfo.deviceName,deviceSecret:t.data.aliyunInfo.deviceSecret,regionId:t.data.aliyunInfo.regionId,port:t.data.aliyunInfo.port}),c="wxs://"+i.host;this.data.options.clientId=i.clientId,this.data.options.password=i.password,this.data.options.username=i.username,this.data.client=o.default.connect(c,this.data.options),console.log(this.data.options),this.data.client.on("connect",(function(e){a.showToast({title:"连接成功"}),console.log("连接成功")})),t.data.client.on("error",(function(e){console.log(" 服务器 error 的回调"+e)})),t.data.client.on("reconnect",(function(){console.log(" 服务器 reconnect的回调")})),t.data.client.on("offline",(function(e){console.log(" 服务器offline的回调")}))}},onLoad:function(e){this.connectAliYun()},onShow:function(){var t=this,n=this;this.data.client.on("message",(function(a,i){console.log(" 收到 topic:"+a+" , payload :"+i);try{var o=t.date;console.log(o);var r=JSON.parse(i).car,s=r.split("_");o.map((function(a,i){if(s[0]==a.id+"")if("0"==s[1]&&1==o[i].status)o[i].status=!1,o[i].endTimer=n.dealTimers,n.cachesSetStorge(o);else{if("1"!=s[1]||0!=o[i].status)return console.log("状态未发生变化"),0;o[i].status=!0,o[i].startTimer=n.dealTimers,o[i].startNowTimer=t.nowTimer,n.cachesSetStorge(o)}return e.$emit("unpdateDataBooking"),1}))}catch(c){console.log("订阅消息的数据格式有误")}}))},onPullDownRefresh:function(){this.getCachesData(4),setTimeout((function(){e.stopPullDownRefresh()}),2e3)}};t.default=c}).call(this,n(2)["default"],n(1)["default"])},99:function(e,t,n){"use strict";n.r(t);var a=n(100),i=n.n(a);for(var o in a)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(o);t["default"]=i.a}},[[92,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/message/message.js.map