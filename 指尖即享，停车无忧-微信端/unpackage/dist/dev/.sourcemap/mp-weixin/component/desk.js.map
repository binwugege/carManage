{"version":3,"sources":["webpack:///D:/HbuildX/demo/hello-uniapp/component/desk.vue?a7ec","webpack:///D:/HbuildX/demo/hello-uniapp/component/desk.vue?3d61","webpack:///D:/HbuildX/demo/hello-uniapp/component/desk.vue?5ebb","webpack:///D:/HbuildX/demo/hello-uniapp/component/desk.vue?6d3a","uni-app:///component/desk.vue","webpack:///D:/HbuildX/demo/hello-uniapp/component/desk.vue?27f0"],"names":["renderjs","component","options","__file","components","uniPopup","e","message","indexOf","console","error","render","_vm","this","_h","$createElement","l0","_self","_c","__map","carData","item","index","$orig","__get_orig","m0","status","dealItem","m1","dealItemd","$mp","data","Object","assign","$root","recyclableRender","staticRenderFns","_withStripped","title","date","id","name","startNowTimer","startTimer","endTimer","yuyue","userCarData","dealTimers","nowTImer","runtime","runtimed","carStatus","clickCar","Ytime","format","indicatorDots","autoplay","interval","duration","client","reconnectCounts","protocolVersion","clean","reconnectPeriod","connectTimeout","resubscribe","clientId","password","username","aliyunInfo","productKey","deviceName","deviceSecret","regionId","pubTopic","subTopic","getCarDataUrl","getCarBookData","loginStatus","user_name","pass_word","props","methods","dealTimer","updateTImer","open","close","axiosGetPost","that","uni","icon","url","method","header","success","bookingData","pushData","fail","confirm","bindDateChange","getDate","year","month","connectAliYun","port","yuyueProcess","getCarData","handleBookingEvent","handleLogin","key","resolve","reject","handleYuyue","events","cancelBooking","watch","pull","handler","deep","created","updated"],"mappings":"+GAAA,oIACIA,EADJ,QASIC,EAAY,qBACd,aACA,YACA,sBACA,EACA,KACA,KACA,MACA,EACA,gBACAD,GAGFC,EAAUC,QAAQC,OAAS,qBACZ,aAAAF,E,0CCvBf,uQ,iCCAA,IAAIG,EAAJ,0LACA,IACEA,EAAa,CACXC,SAAU,WACR,OAAO,qFAKX,MAAOC,GACP,IAC+C,IAA7CA,EAAEC,QAAQC,QAAQ,wBACa,IAA/BF,EAAEC,QAAQC,QAAQ,QAWlB,MAAMF,EATNG,QAAQC,MAAMJ,EAAEC,SAChBE,QAAQC,MAAM,mBACdD,QAAQC,MACN,uFAEFD,QAAQC,MACN,mDAMN,IAAIC,EAAS,WACX,IAAIC,EAAMC,KACNC,EAAKF,EAAIG,eAETC,GADKJ,EAAIK,MAAMC,GACVN,EAAIO,MAAMP,EAAIQ,SAAS,SAAUC,EAAMC,GAC9C,IAAIC,EAAQX,EAAIY,WAAWH,GACvBI,EAAKJ,EAAKK,OAASd,EAAIe,SAASN,GAAQ,KACxCO,EAAMP,EAAKK,OAA+B,KAAtBd,EAAIiB,UAAUR,GACtC,MAAO,CACLE,MAAOA,EACPE,GAAIA,EACJG,GAAIA,OAGRhB,EAAIkB,IAAIC,KAAOC,OAAOC,OACpB,GACA,CACEC,MAAO,CACLlB,GAAIA,MAKRmB,GAAmB,EACnBC,EAAkB,GACtBzB,EAAO0B,eAAgB,G,iCCnDvB,yHAAkmB,eAAG,G,+JCiFrmB,QACA,ukBACA,cAEA,CACAN,gBACA,OACAO,eACAC,MACA,CAAAC,KAAAC,WAAAC,iBAAAC,iBAAAC,eAAAlB,WACA,CAAAc,KAAAC,WAAAC,iBAAAC,iBAAAC,eAAAlB,WACA,CAAAc,KAAAC,WAAAC,iBAAAC,iBAAAC,eAAAlB,WACA,CAAAc,KAAAC,WAAAC,iBAAAC,iBAAAC,eAAAlB,YAEAmB,gBACAC,eACA1B,4BACA2B,cACAC,eACAC,UACAC,WACAC,aACAC,YACAC,oBAAAC,YACAC,iBACAC,YACAC,aACAC,aACA3B,MACA4B,YACAC,kBACA1D,SACA2D,kBACAC,SACAC,oBACAC,mBACAC,eACAC,YACAC,YACAC,aAEAC,YACAC,yBACAC,6BACAC,gDACAC,uBACAC,oDACAC,mDAGAC,iBACAC,mDACAC,cACAC,aACAC,eAIAC,gCACAC,SACAC,sBACA,iBACA,aACA,iCAGAxD,qBACA,WACA,UACA,yEACA,6EAGAE,sBACA,WACA,UACA,uEACA,yEAGAuD,uBACA,WACA,YACA7C,qBAGA9B,2BAKA4E,iBACA,8BACA,wBACA,yBAAA/B,YACA7C,eACAA,yBAEA6E,iBACA,0BAGAC,+BAAA,8JACA,uBASA,GARAC,IAQApE,YACA,8BAOA,OANAqE,aACAnD,aACAoD,eAEAD,cACAE,2BACA,0BAOA,OAAAA,8FAAA,UACAF,WACAE,MACA5D,OACA6D,SACAC,QACA,oDAEAC,oBACA,aACAC,YACAN,aACAnD,aACAoD,iBAIAF,gEACAQ,0DACAR,oEACA/E,kBAGAgF,4BAGAD,gCAGAC,aACAnD,iBACAoD,gBAIAO,iBACAR,aACAnD,iBACAoD,kBAGA,2CAlEA,IAqEAQ,oBAEA,iCACA,0BAGAC,2BACA,wCAKAC,oBACA,eACA,kBACA,iBACA,cAOA,MANA,YACAC,MACA,YACAA,OAEAC,cACA,0CAEAC,yBAEA,WAEA,GADA,UACA,0BACAjC,wCACAC,wCACAC,4CACAC,oCACA+B,+BAGA,kBACA,sCACA,sCACA,sCACA,wDACA,2CACAf,aACAnD,eAEA7B,wBAIAgG,yBACA,WACA1E,qBACAyD,yBAGAkB,uBACA,WACAjB,WACAE,MACA5D,QACA6D,aACAC,QACA,oDAEAC,oBACAN,0BACAA,4BACA/E,qBACAwF,iBACAR,aACAnD,iBACAoD,mBAKAiB,+BACA,WACA,KACAlG,4BACA+E,gEACAQ,sDACAR,oEACA/E,mBAGAmG,uBACA,WACA,kCACAnB,cACAoB,eACAf,oBACAL,WACAE,6CACA5D,YACA6D,cACAC,QACA,oDAEAC,oBACA,aACAN,gBAEAA,iCACAA,iCACA/E,qBAEA+E,gBAEAsB,MACAb,iBACAR,aACAnD,iBACAoD,eAEAqB,SAGAd,gBACAT,uBAKAwB,uBACA,WACAvB,cACAE,+BACAsB,QACAC,0BACA1B,eAQA2B,OACAC,MACAC,mBACA,eAGA,GAFA,WAEA,oBACA,sBACA,4BACA5G,6BACA,iCACA,qCACA,oBAGA6G,UAIAC,mBACA,WACA,sCAEA,WACA,sBAEA,mBAEA9B,wCACAD,2BAEA/E,oBACAA,qBACAA,yBACAA,oBAEA,qBAEA,oBAGA+G,mBACA,eACA,WAEA,qBAMA,c,6DC1bA,yHAA+2B,eAAG,G","file":"component/desk.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./desk.vue?vue&type=template&id=71cc07f9&\"\nvar renderjs\nimport script from \"./desk.vue?vue&type=script&lang=js&\"\nexport * from \"./desk.vue?vue&type=script&lang=js&\"\nimport style0 from \"./desk.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"component/desk.vue\"\nexport default component.exports","export * from \"-!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./desk.vue?vue&type=template&id=71cc07f9&\"","var components\ntry {\n  components = {\n    uniPopup: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-popup/components/uni-popup/uni-popup\" */ \"@/uni_modules/uni-popup/components/uni-popup/uni-popup.vue\"\n      )\n    },\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var l0 = _vm.__map(_vm.carData, function (item, index) {\n    var $orig = _vm.__get_orig(item)\n    var m0 = item.status ? _vm.dealItem(item) : null\n    var m1 = !item.status ? _vm.dealItemd(item) : null\n    return {\n      $orig: $orig,\n      m0: m0,\n      m1: m1,\n    }\n  })\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        l0: l0,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./desk.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./desk.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view>\r\n\t\t<view class=\"main_continue\">\r\n\t\t\t<view class=\"continue\" v-for=\"(item,index) in carData\" :key=\"index\" @click=\"open(index)\">\r\n\t\t\t\t<div class=\"msg_left\">\r\n\t\t\t\t\t<div class=\"msg_left_top\"></div>\r\n\t\t\t\t\t<div class=\"msg_left_bottom\">\r\n\t\t\t\t\t\t<span class=\"data\">设备ID:{{item.id}}</span>\r\n\t\t\t\t\t\t<span class=\"data\">设备名:{{item.name}}</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"msg_right\">\r\n\t\t\t\t\t<div class=\"msg_right_top\">\r\n\t\t\t\t\t\t<span style=\"display: block;margin:20px 0 10px 0;color: red;\">设备运行状态</span>\r\n\t\t\t\t\t\t<view v-if=\"yuyue[index]\">\r\n\t\t\t\t\t\t\t<switch disabled=\"true\" :checked=\"yuyue[index]\" name=\"switch\" />\r\n\t\t\t\t\t\t\t预约中\r\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<view v-else>\r\n\t\t\t\t\t\t\t<switch disabled=\"true\" :checked=\"item.status\" name=\"switch\" />\r\n\t\t\t\t\t\t\t<text v-if=\"item.status\" style=\"color: green;margin-left: 10px;\">运行中</text>\r\n\t\t\t\t\t\t\t<text v-else style=\"color: black;margin-left: 10px;\">空闲中</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"msg_right_bottom\">\r\n\t\t\t\t\t\t<div v-if=\"item.status\">\r\n\t\t\t\t\t\t\t<text style=\"display: block;margin-top: 10px;\">{{item.startNowTimer}}</text>\r\n\t\t\t\t\t\t\t<text style=\"display: block;margin-top: 10px;\">已运行:{{dealItem(item)}}</text>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div v-else class=\"msg_right_bottom\">\r\n\t\t\t\t\t\t\t<span style=\"display: block;margin:10px 0 10px 0;\">上次运行时间:</span>\r\n\t\t\t\t\t\t\t {{dealItemd(item)}}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t</div>\r\n\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<uni-popup ref=\"popup\" type=\"dialog\">\r\n\t\t\t<view class=\"yuyue\">\r\n\t\t\t\t<ul>\r\n\t\t\t\t\t<li><text> 预约车位 </text></li>\r\n\t\t\t\t\t<li>设备ID:{{clickCar.id}}</li>\r\n\t\t\t\t\t<li>设备名字:{{clickCar.name}}</li>\r\n\t\t\t\t\t<!-- 是否运行 -->\r\n\t\t\t\t\t<li v-if=\"clickCar.status\">\r\n\t\t\t\t\t\t<switch  disabled=\"true\" :checked=\"clickCar.status\" name=\"switch\" />\r\n\t\t\t\t\t\t<text style=\"color:green;\">运行中</text>\r\n\t\t\t\t\t</li>\r\n\t\t\t\t\t<li v-else>\r\n\t\t\t\t\t\t<view v-if=\"!yuyue[clickCar.id]\">\r\n\t\t\t\t\t\t\t<text style=\"color:red;\">请选择进站时间:</text>\r\n\t\t\t\t\t\t\t<picker \r\n\t\t\t\t\t\t\t    mode=\"date\" \r\n\t\t\t\t\t\t\t    :value=\"date\" \r\n\t\t\t\t\t\t\t\tfields=\"day\"\r\n\t\t\t\t\t\t\t    :start=\"startDate\" \r\n\t\t\t\t\t\t\t    :end=\"endDate\"     \r\n\t\t\t\t\t\t\t    @change=\"bindDateChange\">\r\n\t\t\t\t\t\t\t\t\t<view>{{ Ytime }}</view>\r\n\t\t\t\t\t\t\t</picker>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view v-else>\r\n\t\t\t\t\t\t\t<switch  disabled=\"true\" :checked=\"yuyue[clickCar.id]\" name=\"switch\" />\r\n\t\t\t\t\t\t\t<text style=\"color:green;\">预约中</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</li>\r\n\t\t\t\t\t<li>\r\n\t\t\t\t\t\t<div style=\"display: flex;\">\r\n\t\t\t\t\t\t\t<button type=\"primary\" @click=\"close\" style=\"width: 40%;background-color:#fbffff;color:black;\">取消</button>\r\n\t\t\t\t\t\t\t<button type=\"primary\" @click=\"confirm(clickCar.id)\" style=\"width: 40%;background-color:#409EFF;color: black;\">确认</button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</li>\r\n\t\t\t\t</ul>\r\n\t\t\t</view>\r\n\t\t</uni-popup>\r\n\t</view>\r\n</template>\n\n<script>\r\n\timport { formatTime } from './../utils/util.js' \r\n\timport mqtt, { log } from './../utils/mqtt.js'\r\n\tconst aliyunOpt = require(\"../utils/aliyun/aliyun_connect.js\");\r\n\t\r\n\texport\tdefault {\r\n\t\tdata(){\r\n\t\t\treturn{\r\n\t\t\t\ttitle:'停车管理系统',\r\n\t\t\t\tdate:[\r\n\t\t\t\t\t{id:0,name:'车位一',startNowTimer:\"\",startTimer:[0,0],endTimer:[0,0],status:false},\r\n\t\t\t\t\t{id:1,name:'车位二',startNowTimer:\"\",startTimer:[0,0],endTimer:[0,0],status:false},\r\n\t\t\t\t\t{id:2,name:'车位三',startNowTimer:\"\",startTimer:[0,0],endTimer:[0,0],status:false},\r\n\t\t\t\t\t{id:3,name:'车位四',startNowTimer:\"\",startTimer:[0,0],endTimer:[0,0],status:false},\r\n\t\t\t\t],\r\n\t\t\t\tyuyue:[0,0,0,0],\r\n\t\t\t\tuserCarData:[],\r\n\t\t\t\tcarData:this.origin_carDate,\r\n\t\t\t\tdealTimers:[],\r\n\t\t\t\tnowTImer:\"---\",\r\n\t\t\t\truntime:0,\r\n\t\t\t\truntimed:0,\r\n\t\t\t\tcarStatus:true,\r\n\t\t\t\tclickCar:{},\r\n\t\t\t\tYtime:this.getDate({format: true}),\r\n\t\t\t\tindicatorDots: true,\r\n\t\t\t\tautoplay: true,\r\n\t\t\t\tinterval: 2000,\r\n\t\t\t\tduration: 500,\r\n\t\t\t\tdata:{\r\n\t\t\t\t\tclient:null,//记录重连的次数\r\n\t\t\t\t\treconnectCounts:0,//MQTT连接的配置\r\n\t\t\t\t\toptions:{\r\n\t\t\t\t\t\tprotocolVersion: 4, //MQTT连接协议版本\r\n\t\t\t\t\t\tclean: false,\r\n\t\t\t\t\t\treconnectPeriod: 1000, //1000毫秒，两次重新连接之间的间隔\r\n\t\t\t\t\t\tconnectTimeout: 30 * 1000, //1000毫秒，两次重新连接之间的间隔\r\n\t\t\t\t\t\tresubscribe: true, //如果连接断开并重新连接，则会再次自动订阅已订阅的主题（默认true）\r\n\t\t\t\t\t\tclientId: '',\r\n\t\t\t\t\t\tpassword: '',\r\n\t\t\t\t\t\tusername: '',\r\n\t\t\t\t\t  },\r\n\t\t\t\t\t  aliyunInfo: {\r\n\t\t\t\t\t\tproductKey: 'i4c2LeyEp9M', //阿里云连接的三元组 ，请自己替代为自己的产品信息!!\r\n\t\t\t\t\t\tdeviceName: 'weichat_booking', //阿里云连接的三元组 ，请自己替代为自己的产品信息!!\r\n\t\t\t\t\t\tdeviceSecret: '29877a488d421e7e7e21436a9321ab7e', //阿里云连接的三元组 ，请自己替代为自己的产品信息!!\r\n\t\t\t\t\t\tregionId: 'cn-shanghai', //阿里云连接的三元组 ，请自己替代为自己的产品信息!!\r\n\t\t\t\t\t\tpubTopic: '/i4c2LeyEp9M/weichat_booking/user/update', //发布消息的主题\r\n\t\t\t\t\t\tsubTopic: '/i4c2LeyEp9M/weichat_booking/user/get', //订阅消息的主题\r\n\t\t\t\t\t  }\r\n\t\t\t\t},\r\n\t\t\t\tgetCarDataUrl:\"\",// 获取数据的url\r\n\t\t\t\tgetCarBookData:\"http://127.0.0.1:8081/car/getData\",\r\n\t\t\t\tloginStatus:0,// 登录状态\r\n\t\t\t\tuser_name:\"\",\r\n\t\t\t\tpass_word:\"\"\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t},\r\n\t\tprops:[\"origin_carDate\",\"pull\"],\r\n\t\tmethods:{\r\n\t\t\tdealTimer(carItem){\r\n\t\t\t\tlet carStartTimer = carItem.startTimer;\r\n\t\t\t\tlet carEndTimer = carItem.endTimer;\r\n\t\t\t\treturn ((carEndTimer[0]-carEndTimer[0])*60 + carEndTimer[1]-carEndTimer[1]);\r\n\t\t\t},\r\n\t\t\t// 正在运行算出正在运行的时间\r\n\t\t\tdealItem(item){\r\n\t\t\t\tconst that = this;\r\n\t\t\t\tconst date = this.date;\r\n\t\t\t\tif((that.dealTimers[0] - item.startTimer[0])>0) return (that.dealTimers[1] - item.startTimer[1])\r\n\t\t\t\treturn (that.dealTimers[0] - item.startTimer[0] - 1)*60 + (60 - item.startTimer[1]) + that.dealTimers[1]\r\n\t\t\t},\r\n\t\t\t// 如果停止运行了 算出运行后的时间\r\n\t\t\tdealItemd(item){\r\n\t\t\t\tconst that = this;\r\n\t\t\t\tconst date = this.date;\r\n\t\t\t\tif((that.dealTimers[0] - item.startTimer[0])>0) return (item.endTimer[1]- item.startTimer[1])\r\n\t\t\t\treturn  (item.endTimer[0] - item.startTimer[0] - 1)*60 + (60 - item.startTimer[1]) + item.endTimer[1]\r\n\t\t\t},\r\n\t\t\t// 暂时没有用到\r\n\t\t\tupdateTImer(){\r\n\t\t\t\tconst that = this;\r\n\t\t\t\tconst date = this.date;\r\n\t\t\t\tdate.map((item,index)=>{\r\n\t\t\t\t\tconst hous = 0;\r\n\t\t\t\t\tconst mins = 0;\r\n\t\t\t\t\tconsole.log(that.runtime);\r\n\t\t\t\t\t// that.runtime = Math.abs(that.dealTimers[0] - item.startTimer[0])*60 + Math.abs(that.dealTimers[1]-item.startTimer[1]);\r\n\t\t\t\t\t// that.runtimed = Math.abs(item.endTimer[0] - item.startTimer[0])*60 +  Math.abs(item.endTimer[1] - item.startTimer[1]);\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\topen(index){\r\n\t\t\t\tthis.clickCar = this.carData[index];\r\n\t\t\t\tthis.$refs.popup.open();\r\n\t\t\t\tthis.Ytime = this.getDate({format: true});\r\n\t\t\t\tconsole.log(index);\r\n\t\t\t\tconsole.log(this.Ytime)\r\n\t\t\t},\r\n\t\t\tclose() {\r\n\t\t\t\tthis.$refs.popup.close();\r\n\t\t\t},\r\n\t\t\t// 处理预约事件\r\n\t\t\tasync axiosGetPost(url,method,data,index){\r\n\t\t\t\tawait this.handleLogin();\r\n\t\t\t\tconst that = this;\r\n\t\t\t\tlet bookingData;\r\n\t\t\t\tlet pushData;\r\n\t\t\t\t\r\n\t\t\t\t/**\r\n\t\t\t\t * 检查用户是否登录\r\n\t\t\t\t * \r\n\t\t\t\t * */\r\n\t\t\t\tconst carData = that.date[index];\r\n\t\t\t\tif(!this.loginStatus){\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle:\"请先登录\",\r\n\t\t\t\t\t\ticon:'error'\r\n\t\t\t\t\t})\r\n\t\t\t\t\tuni.redirectTo({\r\n\t\t\t\t\t\turl:\"/pages/login/login\"\r\n\t\t\t\t\t})\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t/** \r\n\t\t\t\t* 处理用户的预约 \r\n\t\t\t\t**/\r\n\t\t\t\turl = `http://127.0.0.1:8081/car/booking?id=${this.clickCar.id}&phone=${this.user_name}`\r\n\t\t\t\tawait uni.request({\r\n\t\t\t\t\turl:url,\r\n\t\t\t\t\tdata:data,\r\n\t\t\t\t\tmethod:method,\r\n\t\t\t\t\theader: {\r\n\t\t\t\t\t\t\"content-type\": \"application/x-www-form-urlencoded\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess(res) {\r\n\t\t\t\t\t\tif(res.data.code){\r\n\t\t\t\t\t\t\tbookingData = res.data.data;\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle:\"预约成功\",\r\n\t\t\t\t\t\t\t\ticon:\"success\"\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// 发送数据\r\n\t\t\t\t\t\t\tthat.data.client.subscribe(that.data.aliyunInfo.subTopic,function(err){\r\n\t\t\t\t\t\t\t\tpushData = `carData:${carData.id}_1_phone_${that.user_name}`;\r\n\t\t\t\t\t\t\t\tthat.data.client.publish(that.data.aliyunInfo.pubTopic, JSON.stringify(pushData))\t\r\n\t\t\t\t\t\t\t\tconsole.log(pushData)\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t// 同步预约数据\r\n\t\t\t\t\t\t\tuni.$emit(\"breakBookingData\");\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// 重新获取预约的数据\r\n\t\t\t\t\t\t\tthat.getCarData( that.getCarBookData );\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle:res.data.msg,\r\n\t\t\t\t\t\t\t\ticon:'error'\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t},fail(res) {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle:\"获取用户数据失败\",\r\n\t\t\t\t\t\t\ticon:\"error\"\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 用户点击确认按钮\r\n\t\t\tconfirm(index) {\r\n\t\t\t\t// 处理预约事件\r\n                this.axiosGetPost(\"\",\"GET\",{},index);\r\n\t\t\t\tthis.$refs.popup.close()\t\r\n\t\t\t},\r\n\t\t\t// 获取时间用户选择的时间\r\n\t\t\tbindDateChange(e) {\r\n\t\t\t\tthis.Ytime = e.detail.value.substr(0, 10);\r\n\t\t\t\t// console.log(this.Ytime)\r\n\t\t\t\t// this.time = this.Ytime;\r\n\t\t\t},\r\n\t\t\t// 获取当前的时间\r\n\t\t\tgetDate(type) {\r\n\t\t\t\tconst date = new Date();\r\n\t\t\t\tlet year = date.getFullYear();\r\n\t\t\t\tlet month = date.getMonth() + 1;\r\n\t\t\t\tlet day = date.getDate();\r\n\t\t\t\tif (type === 'start') {\r\n\t\t\t\t\tyear = year - 10;\r\n\t\t\t\t} else if (type === 'end') {\r\n\t\t\t\t\tyear = year + 10;\r\n\t\t\t\t}\r\n\t\t\t\tmonth = month > 9 ? month : '0' + month;\r\n\t\t\t\treturn `${year}-${month}-${day}`;\r\n\t\t\t},\r\n\t\t\tconnectAliYun(){\r\n\t\t\t\t\t// clearTimeout(time);\r\n\t\t\t\t\tconst that = this;\r\n\t\t\t\t\tconst carData = this.date;\t\r\n\t\t\t\t\tlet clientOpt = aliyunOpt.getAliyunIotMqttClient({\r\n\t\t\t\t\t  productKey: that.data.aliyunInfo.productKey,\r\n\t\t\t\t\t  deviceName: that.data.aliyunInfo.deviceName,\r\n\t\t\t\t\t  deviceSecret: that.data.aliyunInfo.deviceSecret,\r\n\t\t\t\t\t  regionId: that.data.aliyunInfo.regionId,\r\n\t\t\t\t\t  port: that.data.aliyunInfo.port,\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t\tlet host = 'wxs://' + clientOpt.host;\r\n\t\t\t\t\tthis.data.options.clientId = clientOpt.clientId;\r\n\t\t\t\t\tthis.data.options.password = clientOpt.password;\r\n\t\t\t\t\tthis.data.options.username = clientOpt.username;\r\n\t\t\t\t\tthis.data.client = mqtt.connect(host, this.data.options);\t\t\r\n\t\t\t\t\tthis.data.client.on('connect', function (connack) {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: '连接成功'\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tconsole.log(\"连接成功\");\r\n\t\t\t\t\t})\r\n\t\t\t\t},\r\n\t\t\t\t// 处理预约数据\r\n\t\t\t\tyuyueProcess( data ){\r\n\t\t\t\t\tconst that = this;\r\n\t\t\t\t\tdata.map((item,index)=>{\r\n\t\t\t\t\t\tthat.yuyue[index] = item.booking;\r\n\t\t\t\t\t})\r\n\t\t\t\t},\r\n\t\t\t\tgetCarData( requestUrl ){\r\n\t\t\t\t\tconst that = this;\r\n\t\t\t\t\tuni.request({\r\n\t\t\t\t\t\turl:requestUrl,\r\n\t\t\t\t\t\tdata:{},\r\n\t\t\t\t\t\tmethod:'GET',\r\n\t\t\t\t\t\theader: {\r\n\t\t\t\t\t\t\t\"content-type\": \"application/x-www-form-urlencoded\"\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tsuccess(res) {\r\n\t\t\t\t\t\t\tthat.userCarData = res.data.data;\r\n\t\t\t\t\t\t\tthat.yuyueProcess( res.data.data);\r\n\t\t\t\t\t\t\tconsole.log(res.data)\r\n\t\t\t\t\t\t},fail(res) {\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle:\"获取用户数据失败\",\r\n\t\t\t\t\t\t\t\ticon:\"error\"\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t},\r\n\t\t\t\thandleBookingEvent(dataId){\r\n\t\t\t\t\tconst that = this;\r\n\t\t\t\t\tlet pushData = \"\";\r\n\t\t\t\t\tconsole.log(\"预约成功id:\"+dataId.id);\r\n\t\t\t\t\tthat.data.client.subscribe(that.data.aliyunInfo.subTopic,function(err){\r\n\t\t\t\t\t\tpushData = `carData:${dataId.id}_0_phone_${dataId.phone}`;\r\n\t\t\t\t\t\tthat.data.client.publish(that.data.aliyunInfo.pubTopic, JSON.stringify(pushData))\r\n\t\t\t\t\t\tconsole.log(pushData)\r\n\t\t\t\t\t})\r\n\t\t\t\t},\r\n\t\t\t\thandleLogin(){\r\n\t\t\t\t\tconst that = this;\r\n\t\t\t\t\treturn new Promise((resolve,reject)=>{\r\n\t\t\t\t\t\tuni.getStorage({\r\n\t\t\t\t\t\t\tkey:\"userInfo\",\r\n\t\t\t\t\t\t\tsuccess(val){\r\n\t\t\t\t\t\t\t\tuni.request({\r\n\t\t\t\t\t\t\t\t\turl:\"http://127.0.0.1:8081/user/getUserInfo\",\r\n\t\t\t\t\t\t\t\t\tdata:val.data,\r\n\t\t\t\t\t\t\t\t\tmethod:'POST',\r\n\t\t\t\t\t\t\t\t\theader: {\r\n\t\t\t\t\t\t\t\t\t\t\"content-type\": \"application/x-www-form-urlencoded\"\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\tsuccess(res) {\r\n\t\t\t\t\t\t\t\t\t\tif(res.data.code){\r\n\t\t\t\t\t\t\t\t\t\t\tthat.loginStatus = 1;\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tthat.user_name = res.data.data.userName;\r\n\t\t\t\t\t\t\t\t\t\t\tthat.pass_word = res.data.data.password;\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log(\"登录成功\")\r\n\t\t\t\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t\t\t\tthat.loginStatus = 0;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\tresolve(1);\r\n\t\t\t\t\t\t\t\t\t},fail(res) {\r\n\t\t\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\t\t\ttitle:\"获取用户数据失败\",\r\n\t\t\t\t\t\t\t\t\t\t\ticon:\"error\"\r\n\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\treject(0);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t},fail() {\r\n\t\t\t\t\t\t\t\tthat.loginStatus = 0;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t})\r\n\t\t\t\t},\r\n\t\t\t\thandleYuyue(){\r\n\t\t\t\t\tconst that = this;\r\n\t\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\t\turl:\"/pages/userbook/userbook\",\r\n\t\t\t\t\t\tevents:{\r\n\t\t\t\t\t\t\tcancelBooking:function(sendData){\r\n\t\t\t\t\t\t\t\tthat.test()\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\r\n\t\t},\r\n\t\t// 这里主要用于监听上面的刷新时间 当刷新的时候就会触发这里\r\n\t\twatch:{\r\n\t\t\tpull:{\r\n\t\t\t\thandler(){\r\n\t\t\t\t\tconst data = new Date();\r\n\t\t\t\t\tconst date = this.date;\r\n\t\t\t\t\tconst that = this;\r\n\t\t\t\t\tconst newData = formatTime(data);\r\n\t\t\t\t\tthis.nowTImer = newData.timer;\r\n\t\t\t\t\tthis.dealTimers = newData.jiluTimer;\r\n\t\t\t\t\tconsole.log(this.dealTimers)\r\n\t\t\t\t\tthis.carData = this.origin_carDate;\r\n\t\t\t\t\tthis.getCarData( this.getCarBookData );\r\n\t\t\t\t\tthis.handleLogin();\r\n\t\t\t\t\t// this.updateTImer();\r\n\t\t\t\t},\r\n\t\t\t\tdeep:true,\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 暂时没用用到 目前仅用于查询时间\r\n\t\tcreated(){\r\n\t\t\tconst that = this;\r\n\t\t\tconst getCarData = \"http://127.0.0.1:8081/car/getData\";\r\n\t\t\t\r\n\t\t\tlet data = new Date();\r\n\t\t\tconst newData = formatTime(data);\r\n\t\t\t\r\n\t\t\tthis.handleLogin();\r\n\t\t\t\r\n\t\t\tuni.$on(\"handleBookingEvent\",(data)=>{\r\n\t\t\t\tthat.handleBookingEvent(data);\r\n\t\t\t});\r\n\t\t\tconsole.log(\"test\")\r\n\t\t\tconsole.log(newData.timer);\r\n\t\t\tconsole.log(newData.jiluTimer);\r\n\t\t\tconsole.log(\"数据刷新\")\r\n\t\t\t\r\n\t\t\tthis.connectAliYun();\r\n\t\t\t\r\n\t\t\tthis.getCarData( getCarData );\r\n\t\t},\r\n\t\t// none function printf time\r\n\t\tupdated() {\r\n\t\t\tconst data = new Date();\r\n\t\t\tconst date = this.date;\r\n\t\t\tconst that = this;\r\n\t\t\tconst newData = formatTime(data);\r\n\t\t\t// console.log(\"test\")\r\n\t\t\t// console.log(newData.timer);\r\n\t\t\t// console.log(newData.jiluTimer);\r\n\t\t\t// this.updateTImer();\r\n\t\t}\r\n\t}\r\n\n</script>\n\t\n<style>\r\n\t.main_continue{\r\n\t\twidth: 100%;\r\n\t\theight: 150px;\r\n\t\tbackground-color: #fcfcfc;\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: center;\r\n\t\tflex-wrap: wrap;\r\n\t}\r\n\t.continue{\r\n\t\tdisplay: block;\r\n\t\twidth: 90%;\r\n\t\theight: 100%;\r\n\t\tmargin-top: 20px;\r\n\t\tbackground-color: #fff;\r\n\t\tborder-radius: 20px;\r\n\t\tbox-shadow: 1px 2px 3px 4px #fff4f7;\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: center;\r\n\t}\r\n\t.data{\r\n\t\tdisplay: block;\r\n\t\ttext-align: center;\r\n\t\tmargin-top: 4px;\r\n\t\tcolor: #000000;\r\n\t}\r\n\t.msg_left{\r\n\t\twidth: 50%;\r\n\t\theight: 100%;\r\n\t}\r\n\t.msg_right{\r\n\t\twidth: 50%;\r\n\t\theight: 100%;\r\n\t}\r\n\t.msg_left_top{\r\n\t\twidth: 100%;\r\n\t\theight: 65%;\r\n\t\tbackground-size: 50% 90%;\r\n\t\tborder-radius: 50%;\r\n\t\tbackground-image: url(../static/car.png);\r\n\t\tbackground-repeat: no-repeat;\r\n\t\tbackground-position: center;\r\n\t}\r\n\t.yuyue{\r\n\t\twidth: 300px;\r\n\t\theight: 400px;\r\n\t\tmargin: 0 auto;\r\n\t\tborder-radius: 10px;\r\n\t\tbackground-color: #f5f5f5;\r\n\t\t-webkit-box-shadow: 1px 2px 3px 4px #ffffff;\r\n\t}\r\n\tul{\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t}\r\n\tul li{\r\n\t\ttext-align: center;\r\n\t\tlist-style: none;\r\n\t\twidth: 100%;\r\n\t\theight: 20%;\r\n\t\ttext-align: cneter;\r\n\t\t/* background-color: #f0dee0; */\r\n\t}\r\n\tul li:first-child{\r\n\t\tline-height: 50px;\r\n\t\tfont-size: 20px;\r\n\t\tcolor:#d43c28;\r\n\t}\r\n\t\n</style>\n","import mod from \"-!../../../HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./desk.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./desk.vue?vue&type=style&index=0&lang=css&\""],"sourceRoot":""}